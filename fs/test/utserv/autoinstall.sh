#!/bin/sh
#####################################################################################################################################################################
#														Installation Script for Mods Tools																			#
#####################################################################################################################################################################
#																																									#
#                                                                                                                                                               	#
#  	              AAA                                TTTTTTTTTTTTTTTTTTTTTTTEEEEEEEEEEEEEEEEEEEEEE               AAA               MMMMMMMM               MMMMMMMM  #
#  	             A:::A                               T:::::::::::::::::::::TE::::::::::::::::::::E              A:::A              M:::::::M             M:::::::M  #
#  	            A:::::A                              T:::::::::::::::::::::TE::::::::::::::::::::E             A:::::A             M::::::::M           M::::::::M  #
#  	           A:::::::A                             T:::::TT:::::::TT:::::TEE::::::EEEEEEEEE::::E            A:::::::A            M:::::::::M         M:::::::::M  #
#  	          A:::::::::A                            TTTTTT  T:::::T  TTTTTT  E:::::E       EEEEEE           A:::::::::A           M::::::::::M       M::::::::::M  #
#  	         A:::::A:::::A                                   T:::::T          E:::::E                       A:::::A:::::A          M:::::::::::M     M:::::::::::M  #
#  	        A:::::A A:::::A                                  T:::::T          E::::::EEEEEEEEEE            A:::::A A:::::A         M:::::::M::::M   M::::M:::::::M  #
#  	       A:::::A   A:::::A         ---------------         T:::::T          E:::::::::::::::E           A:::::A   A:::::A        M::::::M M::::M M::::M M::::::M  #
#  	      A:::::A     A:::::A        -:::::::::::::-         T:::::T          E:::::::::::::::E          A:::::A     A:::::A       M::::::M  M::::M::::M  M::::::M  #
#		 A:::::AAAAAAAAA:::::A       ---------------         T:::::T          E::::::EEEEEEEEEE         A:::::AAAAAAAAA:::::A      M::::::M   M:::::::M   M::::::M  #
#		A:::::::::::::::::::::A                              T:::::T          E:::::E                  A:::::::::::::::::::::A     M::::::M    M:::::M    M::::::M  #
#	   A:::::AAAAAAAAAAAAA:::::A                             T:::::T          E:::::E       EEEEEE    A:::::AAAAAAAAAAAAA:::::A    M::::::M     MMMMM     M::::::M  #
#	  A:::::A             A:::::A                          TT:::::::TT      EE::::::EEEEEEEE:::::E   A:::::A             A:::::A   M::::::M               M::::::M  #
#	 A:::::A               A:::::A                         T:::::::::T      E::::::::::::::::::::E  A:::::A               A:::::A  M::::::M               M::::::M  #
#	A:::::A                 A:::::A                        T:::::::::T      E::::::::::::::::::::E A:::::A                 A:::::A M::::::M               M::::::M  #
#  AAAAAAA                   AAAAAAA                       TTTTTTTTTTT      EEEEEEEEEEEEEEEEEEEEEEAAAAAAA                   AAAAAAAMMMMMMMM               MMMMMMMM  #
#																																									#
#####################################################################################################################################################################

function displayImage {
	slay APP_SUM
	slay -s 9 NAV_Manager
	slay -s 9 fordhmi
	slay -s 9 HMI_AL
	display_image -file=/fs/usb0/SyncMyMod/installation_${1}.png -display=2 &

	while [ -e /fs/usb0 ]; do
		sleep 1
	done

	shutdown

	exit 0
}

#########################################################################################################################################################
#																Check if Mods Tools are installed														#
#########################################################################################################################################################
if [[ ! -f "/fs/usb0/SyncMyMod/utserviceutility" ]]; then
	displayImage "aborted"
fi

mkdir -p /fs/rwdata/dev/

cp /fs/usb0/SyncMyMod/utserviceutility /fs/rwdata/dev/
cp /fs/usb0/SyncMyMod/patch /fs/rwdata/dev/
cp /fs/usb0/SyncMyMod/remount_rw.sh /fs/rwdata/dev/
cp /fs/usb0/SyncMyMod/remount_ro.sh /fs/rwdata/dev/

chmod a+x /fs/rwdata/dev/*

#####################################################################################################################################################
#																Apply Patch and Mod																    #
#####################################################################################################################################################
echo "MODS_TOOLS" > /fs/rwdata/dev/mods_tools.txt

#####################################################################################################################################################
#																Display success image and reboot													#
#####################################################################################################################################################	
displayImage "completed"
